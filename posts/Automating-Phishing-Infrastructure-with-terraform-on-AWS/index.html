<!DOCTYPE html><html lang="en-US" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="pv-cache-enabled" content="false"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="Automating Phishing Infrastructure with terraform on AWS" /><meta name="author" content="Dazzy Ddos" /><meta property="og:locale" content="en_US" /><meta name="description" content="Introduction" /><meta property="og:description" content="Introduction" /><link rel="canonical" href="https://dazzyddos.github.io/posts/Automating-Phishing-Infrastructure-with-terraform-on-AWS/" /><meta property="og:url" content="https://dazzyddos.github.io/posts/Automating-Phishing-Infrastructure-with-terraform-on-AWS/" /><meta property="og:site_name" content="Dazzy Ddos" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-04-30T14:10:00+03:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Automating Phishing Infrastructure with terraform on AWS" /><meta name="twitter:site" content="@dazzyddos" /><meta name="twitter:creator" content="@Dazzy Ddos" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"Dazzy Ddos"},"description":"Introduction","url":"https://dazzyddos.github.io/posts/Automating-Phishing-Infrastructure-with-terraform-on-AWS/","@type":"BlogPosting","headline":"Automating Phishing Infrastructure with terraform on AWS","dateModified":"2021-05-01T07:05:02+03:00","datePublished":"2021-04-30T14:10:00+03:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://dazzyddos.github.io/posts/Automating-Phishing-Infrastructure-with-terraform-on-AWS/"},"@context":"https://schema.org"}</script><title>Automating Phishing Infrastructure with terraform on AWS | Dazzy Ddos</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://avatars.githubusercontent.com/u/25081660?s=460&u=d7eb9a459d672ab9b0b1ccead34de3233e2843ee&v=4" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Dazzy Ddos</a></div><div class="site-subtitle font-italic"></div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/dazzyddos" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/dazzyddos" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['',''].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG â€º <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Automating Phishing Infrastructure with terraform on AWS</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Automating Phishing Infrastructure with terraform on AWS</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Fri, Apr 30, 2021, 2:10 PM +0300" > Apr 30, 2021 <i class="unloaded">2021-04-30T14:10:00+03:00</i> </span> by <span class="author"> Dazzy Ddos </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Sat, May 1, 2021, 9:35 AM +0530" > May 1, 2021 <i class="unloaded">2021-05-01T07:05:02+03:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2754 words">15 min</span></div></div><div class="post-content"><h2 id="introduction">Introduction</h2><p>Hola, cariÃ±o readers. I hope you all are doing good and safe. In this blog post, I will walk you through creating an EC2 Instance on AWS and then installing and setting Gophish instance on the same manually from scratch. After that weâ€™ll look into how we could automate everything from creating and setting ec2 instance till installing and running gophish on our created instance with terraform. I am a firm believer that you canâ€™t learn anything well unless you do it. So, I would want everyone to follow along with me because you donâ€™t learn by learning, you learn by doing :P . Okay so enough with my ugly philosophies, letâ€™s get started. I am going to be assuming that you have an account on AWS, if not you can go and create one account now, it wonâ€™t take much time and on top of that itâ€™s free(limited resources/usage) for an year although it asks for credit card information for confimation. Rest of the tools weâ€™ll install as we go.</p><h1 id="manual-approach">Manual Approach</h1><h2 id="creating-ec2-instance">Creating EC2 Instance</h2><p>With that being said, letâ€™s get going with creating our EC2 instance on which weâ€™ll run our gophish. If you know how to create an ec2 instance, you can skip this part. When we visit <code class="language-plaintext highlighter-rouge">console.aws.amazon.com</code> we get presented with this Dashboard. <em>It might change in future.</em></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/terraform-gophish/Pasted%20image%2020210430195811.png" alt="" /></p><p>Click on <strong>EC2</strong> to go to the EC2 Dashboard. <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/terraform-gophish/Pasted%20image%2020210430195957.png" alt="" /></p><p>Click on instances. By default itâ€™ll show only those instances which are running. You can need to remove the running tab to see all Instances. <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/terraform-gophish/Pasted%20image%2020210430200124.png" alt="" /></p><p>If you havenâ€™t created any instances, it would be empty for you regardless. Click on <strong>Launch instances</strong> <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/terraform-gophish/Pasted%20image%2020210430200411.png" alt="" /></p><p>Now here select <em>free tier</em> box to list only those images which comes under free tier subscription. <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/terraform-gophish/Pasted%20image%2020210430200519.png" alt="" /></p><p>Iâ€™m going to be choosing the first image i.e., <strong>Amazon Linux 2 AMI (HVM)</strong> .You can choose any image. At next make sure you select t2.micro. <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/terraform-gophish/Pasted%20image%2020210430200828.png" alt="" /></p><p>At next step, you add some configuration to your EC2 instance if you want like if you want to place it inside any particular VPC you have created or want to attach any IAM role to it if it needs to access any other AWS resource and so on. For our case, we donâ€™t need to do any configuration at this stage so weâ€™ll move to next stage. <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/terraform-gophish/Pasted%20image%2020210430201048.png" alt="" /></p><p>At next step, we can add/modify storage. Note that free tier is only eligible for 30 Gigs of SSD storage. <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/terraform-gophish/Pasted%20image%2020210430201209.png" alt="" /></p><p>Weâ€™ll move to next step where we asked if we want to add any tag to our ec2 instance. Think of tag as just a label which consists of key and value pair that we add to AWS resources to organize them. Note that each tag must be unique. <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/terraform-gophish/Pasted%20image%2020210430201323.png" alt="" /></p><p>For now we donâ€™t want to add any tag so weâ€™ll move to next step. Next comes security groups where we specify firewall rules (allow/deny inbound/outbound traffic). For now, we donâ€™t want to open any outbound connection although while setting up gophish, weâ€™ll have to open some ports that weâ€™ll do it later while setting up. <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/terraform-gophish/Pasted%20image%2020210430201504.png" alt="" /></p><p>So, finally letâ€™s click on <strong>Review and Launch</strong>. We need to create a new ssh keys so that we can ssh into our instance once it has started. <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/terraform-gophish/Pasted%20image%2020210430202101.png" alt="" /></p><p>Yayyy our instance is running. When clicking on the instance name, weâ€™ll be taken back to the instances dashboard. <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/terraform-gophish/Pasted%20image%2020210430202219.png" alt="" /></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/terraform-gophish/Pasted%20image%2020210430202304.png" alt="" /></p><p>Letâ€™s SSH into it. Right click on the instance name and click on connect. <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/terraform-gophish/Pasted%20image%2020210430202349.png" alt="" /></p><p>Clicking on the SSH Client tab, we can see the instruction to connect to our instance. Letâ€™s do it.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/terraform-gophish/Pasted%20image%2020210430202453.png" alt="" /></p><p>Make sure to change your permission of the private key before ssh yells at you. <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/terraform-gophish/Pasted%20image%2020210430202805.png" alt="" /></p><h2 id="installing-gophish-on-linux-vmi-ec2-instance">Installing Gophish on Linux VMI EC2 Instance</h2><p>Now that we have created and connected to our ec2 instance, all thatâ€™s left to do is to download and setting up gophish.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/terraform-gophish/Pasted%20image%2020210430203434.png" alt="" /></p><p>Right click and copy the link and come back to the instance and download the zip file using <strong>wget</strong>. I am going to download it to the <em>/opt</em> directory for which I need to su to root first. The current user we are running as has permission to run sudo. So by just doing <code class="language-plaintext highlighter-rouge">sudo su</code> weâ€™ll be presented with root shell.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/terraform-gophish/Pasted%20image%2020210430203707.png" alt="" /></p><p>After unzipping the file, we just need to set the executable permission on the program. Before running the gophish program, we need to do a very small change in the config.json. Currently by default gophish will only run on localhost IP, we need to set 0.0.0.0 so that it listens on all interfaces including public interface so that we can access it from the internet. We can also do Local Port Forwarding to access it from our machine but for now letâ€™s make it accessible from internet.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/terraform-gophish/Pasted%20image%2020210430204132.png" alt="" /></p><p>Now letâ€™s run the gophish. You should be seeing the below log if everything was fine till here. <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/terraform-gophish/Pasted%20image%2020210430204226.png" alt="" /></p><p>We have the public IP Address of our instance from the connect dashboard, letâ€™s try to access our gophish instance from internet.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/terraform-gophish/Pasted%20image%2020210430204454.png" alt="" /></p><h2 id="adding-inbound-connections">Adding Inbound connections</h2><p>Mmmmm strange, isnâ€™t it. No itâ€™s not strange at all you baaka. We have not opened inbound ports (3333 and 80) during the security groups step. So, letâ€™s do it now. When you scroll down from the left panel of instance dashboard, you can see the option for security groups. <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/terraform-gophish/Pasted%20image%2020210430204653.png" alt="" /></p><p>When you visit the security groups, you can see all the security groups present out of which you need to select the one your ec2 is part of. <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/terraform-gophish/Pasted%20image%2020210430205031.png" alt="" /></p><p>You can see your group id by visiting the security tab of your ec2 instance. <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/terraform-gophish/Pasted%20image%2020210430205143.png" alt="" /></p><p>Letâ€™s go back to the security groups option and select our security group id.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/terraform-gophish/Pasted%20image%2020210430205315.png" alt="" /></p><p>We can edit inbound rules to add two new rules (Custom TCP) which opens port 80 and 3333 and allows traffic to flow through. In the CIDR input, select 0.0.0.0/0</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/terraform-gophish/Pasted%20image%2020210430205522.png" alt="" /></p><h2 id="creating-a-phishing-campaign-in-gophish">Creating a Phishing campaign in Gophish</h2><p>Save the rule and after some time letâ€™s check if we could access our gophish instance. Yeyyyyy, now itâ€™s accessible. Make sure you are using https instead of http and accept the ssl warning and youâ€™ll be presented here.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/terraform-gophish/Pasted%20image%2020210430205701.png" alt="" /></p><p>In the earlier version of Gophish the default creds used to be <strong>admin : gophish</strong> but in recent version the gophish instance generates a random password the first time we run the gophish instance. If you go back to your gophish log, you could see the random password it created.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/terraform-gophish/Pasted%20image%2020210430210035.png" alt="" /></p><p>We need to use that password with admin user after which weâ€™ll be asked to set the new password.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/terraform-gophish/Pasted%20image%2020210430210133.png" alt="" /></p><p>Weâ€™ll create a new group first where weâ€™ll add one user for now.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/terraform-gophish/Pasted%20image%2020210430210325.png" alt="" /></p><p>Then weâ€™ll create our landing page. I have imported the gmail login page.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/terraform-gophish/Pasted%20image%2020210430210549.png" alt="" /></p><p>Then weâ€™ll create Email Template. I will copy one mail which I have in my mail id.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/terraform-gophish/Pasted%20image%2020210430213212.png" alt="" /></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/terraform-gophish/Pasted%20image%2020210430213243.png" alt="" /></p><p>And then paste the html code in the Import Email input.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/terraform-gophish/Pasted%20image%2020210430213353.png" alt="" /></p><p>Now we need to create a sending profile where weâ€™ll fill our smtp server. In my case, I am using the outlook, you can use your custom domain if you have any. I was having problem with gmail server but outlook worked for me. You can click on Send Test to send a test mail to confirm if your smtp server is working.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/terraform-gophish/Pasted%20image%2020210430214125.png" alt="" /></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/terraform-gophish/Pasted%20image%2020210430213915.png" alt="" /></p><p>Now letâ€™s create our campaign.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/terraform-gophish/Pasted%20image%2020210430215441.png" alt="" /></p><p>Everything is obvious, in the url input we are specifying the ip address where our phishing page will be hosted.</p><p>After you have launched your campaign, you can see the status.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/terraform-gophish/Pasted%20image%2020210430214524.png" alt="" /></p><p>After a while we can see that the phishing mails have been sent.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/terraform-gophish/Pasted%20image%2020210430214616.png" alt="" /></p><p>Letâ€™s act as a target and open the mail.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/terraform-gophish/Pasted%20image%2020210430215036.png" alt="" /></p><p>mmmmm i got the mail but itâ€™s detected as phishing mail. Fooling mail servers to make our phishing mail look like legit mail is an another tutorial/blog in itself. So, I will leave it for maybe next blog.</p><p>All the links in that mail is point to our phishing site(gmail). Letâ€™s open the link and enter our credentials.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/terraform-gophish/Pasted%20image%2020210430215527.png" alt="" /></p><p>It looks exact replica of the gmail login except for the url part :P which can be also be setup properly.</p><p>Anyways, letâ€™s enter the credentials and if we go back to the Dashboard, we can see our campaign results.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/terraform-gophish/Pasted%20image%2020210430215804.png" alt="" /></p><h1 id="automation-approach">Automation Approach</h1><h2 id="automating-setting-up-gophish-on-ec2-with-terraform">Automating setting up gophish on EC2 with terraform</h2><p>The setting up gophish on AWS EC2 instance part ends here. Now weâ€™ll see how we could automate everything from creating and starting an instance till downloading and running the gophish on our ec2 with terraform. Before moving forward, weâ€™ll first delete the ec2 instance we created manually.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/terraform-gophish/Pasted%20image%2020210430220219.png" alt="" /></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/terraform-gophish/Pasted%20image%2020210430220617.png" alt="" /></p><p>You can all download terraform from the officlal hashicorp website : https://www.terraform.io/downloads.html</p><p>In my case I am going to be using the terraform on my Windows machine. You can see if terraform has been installed by running</p><div class="language-markdown highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>terraform --version
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/terraform-gophish/Pasted%20image%2020210430220409.png" alt="" /></p><p>If you are also using Windows machine then you need to edit the PATH environment to point to the location where terraform is installed.</p><p>Terraform is an open-source infrastructure as code software tool created by Hashicorp. It can be used to provision cloud resources by using a declarative language called HCL (Hashicorp Configuration Language).</p><p>Before we start creating our configuration file for terraform, we need to create a user with programmatic acess whose access key terraform can use while provision the cloud resources.</p><p>Go to IAM &gt; Users &gt; Add users</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/terraform-gophish/Pasted%20image%2020210430221410.png" alt="" /></p><p>Make sure you have the Programmatic Access box selected. Go to next step where we need to add the AdministratorAccess policy to this user.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/terraform-gophish/Pasted%20image%2020210430221525.png" alt="" /></p><p>We can skip the next step where it asks to add the tag. Review and then create user.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/terraform-gophish/Pasted%20image%2020210430221624.png" alt="" /></p><p>Copy the access key and secret key you got somewhere safe since we need to put it in the terraform configuration.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/terraform-gophish/Pasted%20image%2020210430221721.png" alt="" /></p><p>I wonâ€™t be going into detail of every syntax of terraform. You can look into the official documentation if you want to know more about any particular syntax.</p><p>Letâ€™s start creating our terraform file. Since terraform can be used to provision on multiple cloud platforms (AWS, Azure, GCP, Alibaba cloud to name a few), we first need to speicy which provider we are using in our configuration file.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>provider <span class="s2">"aws"</span> <span class="o">{</span>
  region     <span class="o">=</span> <span class="s2">"us-east-1"</span>
  access_key <span class="o">=</span> <span class="s2">"AKIA...[snip]"</span>
  secret_key <span class="o">=</span> <span class="s2">"/Q...[snip]"</span>
<span class="o">}</span>
</pre></table></code></div></div><p>And then next step is to create a security group resource whereâ€™ll add ingress rules to open specific ports for the gophish. Here we are saying the same thing i.e., to allow traffice from and to port 22,80 and 3333 from all IP Addresses.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
</pre><td class="rouge-code"><pre>resource <span class="s2">"aws_security_group"</span> <span class="s2">"main"</span> <span class="o">{</span>
  egress <span class="o">=</span> <span class="o">[</span>
    <span class="o">{</span>
      cidr_blocks      <span class="o">=</span> <span class="o">[</span> <span class="s2">"0.0.0.0/0"</span>, <span class="o">]</span>
      description      <span class="o">=</span> <span class="s2">""</span>
      from_port        <span class="o">=</span> 0
      ipv6_cidr_blocks <span class="o">=</span> <span class="o">[]</span>
      prefix_list_ids  <span class="o">=</span> <span class="o">[]</span>
      protocol         <span class="o">=</span> <span class="s2">"-1"</span>
      security_groups  <span class="o">=</span> <span class="o">[]</span>
      self             <span class="o">=</span> <span class="nb">false
      </span>to_port          <span class="o">=</span> 0
    <span class="o">}</span>
  <span class="o">]</span>
 ingress                <span class="o">=</span> <span class="o">[</span>
   <span class="o">{</span>
     cidr_blocks      <span class="o">=</span> <span class="o">[</span> <span class="s2">"0.0.0.0/0"</span>, <span class="o">]</span>
     description      <span class="o">=</span> <span class="s2">""</span>
     from_port        <span class="o">=</span> 22
     ipv6_cidr_blocks <span class="o">=</span> <span class="o">[]</span>
     prefix_list_ids  <span class="o">=</span> <span class="o">[]</span>
     protocol         <span class="o">=</span> <span class="s2">"tcp"</span>
     security_groups  <span class="o">=</span> <span class="o">[]</span>
     self             <span class="o">=</span> <span class="nb">false
     </span>to_port          <span class="o">=</span> 22
  <span class="o">}</span>,
  <span class="o">{</span>
     cidr_blocks <span class="o">=</span> <span class="o">[</span> <span class="s2">"0.0.0.0/0"</span>, <span class="o">]</span>
     description <span class="o">=</span> <span class="s2">"gophish 80"</span>
     from_port <span class="o">=</span> 80
     ipv6_cidr_blocks <span class="o">=</span> <span class="o">[]</span>
     prefix_list_ids <span class="o">=</span> <span class="o">[]</span>
     protocol <span class="o">=</span> <span class="s2">"tcp"</span>
     security_groups <span class="o">=</span> <span class="o">[]</span>
     self <span class="o">=</span> <span class="nb">false
     </span>to_port <span class="o">=</span> 80
  <span class="o">}</span>,
  <span class="o">{</span>
     cidr_blocks <span class="o">=</span> <span class="o">[</span> <span class="s2">"0.0.0.0/0"</span>, <span class="o">]</span>
     description <span class="o">=</span> <span class="s2">"gophish 3333"</span>
     from_port <span class="o">=</span> 3333
     ipv6_cidr_blocks <span class="o">=</span> <span class="o">[]</span>
     prefix_list_ids <span class="o">=</span> <span class="o">[]</span>
     protocol <span class="o">=</span> <span class="s2">"tcp"</span>
     security_groups <span class="o">=</span> <span class="o">[]</span>
     self <span class="o">=</span> <span class="nb">false
     </span>to_port <span class="o">=</span> 3333
  <span class="o">}</span>
  <span class="o">]</span>
<span class="o">}</span>
</pre></table></code></div></div><p>Next we need to add <code class="language-plaintext highlighter-rouge">aws_key_pair</code> resource to ssh into the instance if or when we want. I will require to generate ssh keys which can be done using <code class="language-plaintext highlighter-rouge">ssh-keygen</code></p><p>Copy the public key into the same directory where the terraform configuration file will live since we need to tell terraform to put the public into the instance so that we can ssh into it using our private key.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>resource <span class="s2">"aws_key_pair"</span> <span class="s2">"ssh-key"</span><span class="o">{</span>
    key_name <span class="o">=</span> <span class="s2">"ssh-key"</span>
    public_key <span class="o">=</span> <span class="s2">"</span><span class="k">${</span><span class="nv">file</span><span class="p">(</span><span class="s2">"id_rsa.pub"</span><span class="p">)</span><span class="k">}</span><span class="s2">"</span>
<span class="o">}</span>
</pre></table></code></div></div><p>Final step is to create our <code class="language-plaintext highlighter-rouge">aws_instance</code> resource. Before that weâ€™d require the ami id. If you go the Instances &gt; launch Instance, youâ€™ll find the ami id.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/terraform-gophish/Pasted%20image%2020210430222957.png" alt="" /></p><p>Next we need to create a simple bash script which we have to run as soon as the instance is created and started by terraform. What this bash script will do is download gophish, unzip it, modify the config.json and then will simply run. I have added the comments for each line.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="c">#!/bin/bash</span>

<span class="nb">cd</span> /opt    <span class="c"># change directory to /opt</span>
wget https://github.com/gophish/gophish/releases/download/v0.11.0/gophish-v0.11.0-linux-64bit.zip    <span class="c"># download the gophish zip</span>
unzip gophish-v0.11.0-linux-64bit.zip       <span class="c"># unzip the gophish zip file</span>
<span class="nb">sed</span> <span class="nt">-i</span> <span class="s1">'s/127\.0\.0\.1/0\.0\.0\.0/g'</span> config.json   <span class="c"># replate 127.0.0.1 with 0.0.0.0</span>
<span class="nb">chmod</span> +x ./gophish   <span class="c"># set executable bit on gophish program</span>
./gophish            <span class="c"># finally just run the program</span>
</pre></table></code></div></div><p>We need to convert it to base64 and provide it in the terraform configuration file and then terraform wiill run this script on the instance when itâ€™s started.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nb">base64</span> <span class="nt">-w</span> 0 script.sh
<span class="nv">IyEvYmluL2Jhc2gKCmNkIC9vcHQKd2dldCBodHRwczovL2dpdGh1Yi5jb20vZ29waGlzaC9nb3BoaXNoL3JlbGVhc2VzL2Rvd25sb2FkL3YwLjExLjAvZ29waGlzaC12MC4xMS4wLWxpbnV4LTY0Yml0LnppcAp1bnppcCBnb3BoaXNoLXYwLjExLjAtbGludXgtNjRiaXQuemlwCnNlZCAtaSAncy8xMjdcLjBcLjBcLjEvMFwuMFwuMFwuMC9nJyBjb25maWcuanNvbgpjaG1vZCAreCAuL2dvcGhpc2gKLi9nb3BoaXNoCg</span><span class="o">==</span>
</pre></table></code></div></div><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>resource <span class="s2">"aws_instance"</span> <span class="s2">"ec2_instance"</span> <span class="o">{</span>
  ami           <span class="o">=</span> <span class="s2">"ami-048f6ed62451373d9"</span>
  instance_type <span class="o">=</span> <span class="s2">"t2.micro"</span>

  key_name <span class="o">=</span> <span class="s2">"</span><span class="k">${</span><span class="nv">aws_key_pair</span><span class="p">.test-key.key_name</span><span class="k">}</span><span class="s2">"</span>
  tags <span class="o">=</span> <span class="o">{</span>
        Name <span class="o">=</span> <span class="s2">"Gophish-VM"</span>
  <span class="o">}</span>

  vpc_security_group_ids <span class="o">=</span> <span class="o">[</span>aws_security_group.main.id]
  user_data_base64 <span class="o">=</span> <span class="s2">"IyEvYmluL2Jhc2gKCmNkIC9vcHQKd2dldCBodHRwczovL2dpdGh1Yi5jb20vZ29waGlzaC9nb3BoaXNoL3JlbGVhc2VzL2Rvd25sb2FkL3YwLjExLjAvZ29waGlzaC12MC4xMS4wLWxpbnV4LTY0Yml0LnppcAp1bnppcCBnb3BoaXNoLXYwLjExLjAtbGludXgtNjRiaXQuemlwCnNlZCAtaSAncy8xMjdcLjBcLjBcLjEvMFwuMFwuMFwuMC9nJyBjb25maWcuanNvbgpjaG1vZCAreCAuL2dvcGhpc2gKLi9nb3BoaXNoCg=="</span>
<span class="o">}</span>
</pre></table></code></div></div><p>As can be seen, we have provided our base64 version of bash script to the user_data_base64 variable. So, our final terraform configuration file will look something like this. You can name terraform HCL file anything, just it has to end with .tf extension.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
</pre><td class="rouge-code"><pre>provider <span class="s2">"aws"</span> <span class="o">{</span>
  region     <span class="o">=</span> <span class="s2">"us-east-1"</span>
  access_key <span class="o">=</span> <span class="s2">"AKIA...[snip]"</span>
  secret_key <span class="o">=</span> <span class="s2">"/Q...[snip]"</span>
<span class="o">}</span>

resource <span class="s2">"aws_security_group"</span> <span class="s2">"main"</span> <span class="o">{</span>
  egress <span class="o">=</span> <span class="o">[</span>
    <span class="o">{</span>
      cidr_blocks      <span class="o">=</span> <span class="o">[</span> <span class="s2">"0.0.0.0/0"</span>, <span class="o">]</span>
      description      <span class="o">=</span> <span class="s2">""</span>
      from_port        <span class="o">=</span> 0
      ipv6_cidr_blocks <span class="o">=</span> <span class="o">[]</span>
      prefix_list_ids  <span class="o">=</span> <span class="o">[]</span>
      protocol         <span class="o">=</span> <span class="s2">"-1"</span>
      security_groups  <span class="o">=</span> <span class="o">[]</span>
      self             <span class="o">=</span> <span class="nb">false
      </span>to_port          <span class="o">=</span> 0
    <span class="o">}</span>
  <span class="o">]</span>
 ingress                <span class="o">=</span> <span class="o">[</span>
   <span class="o">{</span>
     cidr_blocks      <span class="o">=</span> <span class="o">[</span> <span class="s2">"0.0.0.0/0"</span>, <span class="o">]</span>
     description      <span class="o">=</span> <span class="s2">""</span>
     from_port        <span class="o">=</span> 22
     ipv6_cidr_blocks <span class="o">=</span> <span class="o">[]</span>
     prefix_list_ids  <span class="o">=</span> <span class="o">[]</span>
     protocol         <span class="o">=</span> <span class="s2">"tcp"</span>
     security_groups  <span class="o">=</span> <span class="o">[]</span>
     self             <span class="o">=</span> <span class="nb">false
     </span>to_port          <span class="o">=</span> 22
  <span class="o">}</span>,
  <span class="o">{</span>
     cidr_blocks <span class="o">=</span> <span class="o">[</span> <span class="s2">"0.0.0.0/0"</span>, <span class="o">]</span>
     description <span class="o">=</span> <span class="s2">"gophish 80"</span>
     from_port <span class="o">=</span> 80
     ipv6_cidr_blocks <span class="o">=</span> <span class="o">[]</span>
     prefix_list_ids <span class="o">=</span> <span class="o">[]</span>
     protocol <span class="o">=</span> <span class="s2">"tcp"</span>
     security_groups <span class="o">=</span> <span class="o">[]</span>
     self <span class="o">=</span> <span class="nb">false
     </span>to_port <span class="o">=</span> 80
  <span class="o">}</span>,
  <span class="o">{</span>
     cidr_blocks <span class="o">=</span> <span class="o">[</span> <span class="s2">"0.0.0.0/0"</span>, <span class="o">]</span>
     description <span class="o">=</span> <span class="s2">"gophish 3333"</span>
     from_port <span class="o">=</span> 3333
     ipv6_cidr_blocks <span class="o">=</span> <span class="o">[]</span>
     prefix_list_ids <span class="o">=</span> <span class="o">[]</span>
     protocol <span class="o">=</span> <span class="s2">"tcp"</span>
     security_groups <span class="o">=</span> <span class="o">[]</span>
     self <span class="o">=</span> <span class="nb">false
     </span>to_port <span class="o">=</span> 3333
  <span class="o">}</span>
  <span class="o">]</span>
<span class="o">}</span>

resource <span class="s2">"aws_key_pair"</span> <span class="s2">"ssh-key"</span><span class="o">{</span>
    key_name <span class="o">=</span> <span class="s2">"ssh-key"</span>
    public_key <span class="o">=</span> <span class="s2">"</span><span class="k">${</span><span class="nv">file</span><span class="p">(</span><span class="s2">"id_rsa.pub"</span><span class="p">)</span><span class="k">}</span><span class="s2">"</span>
<span class="o">}</span>

resource <span class="s2">"aws_instance"</span> <span class="s2">"ec2_instance"</span> <span class="o">{</span>
  ami           <span class="o">=</span> <span class="s2">"ami-048f6ed62451373d9"</span>
  instance_type <span class="o">=</span> <span class="s2">"t2.micro"</span>

  key_name <span class="o">=</span> <span class="s2">"</span><span class="k">${</span><span class="nv">aws_key_pair</span><span class="p">.ssh-key.key_name</span><span class="k">}</span><span class="s2">"</span>
  tags <span class="o">=</span> <span class="o">{</span>
        Name <span class="o">=</span> <span class="s2">"Gophish-VM"</span>
  <span class="o">}</span>

  vpc_security_group_ids <span class="o">=</span> <span class="o">[</span>aws_security_group.main.id]
  user_data_base64 <span class="o">=</span> <span class="s2">"IyEvYmluL2Jhc2gKCmNkIC9vcHQKd2dldCBodHRwczovL2dpdGh1Yi5jb20vZ29waGlzaC9nb3BoaXNoL3JlbGVhc2VzL2Rvd25sb2FkL3YwLjExLjAvZ29waGlzaC12MC4xMS4wLWxpbnV4LTY0Yml0LnppcAp1bnppcCBnb3BoaXNoLXYwLjExLjAtbGludXgtNjRiaXQuemlwCnNlZCAtaSAncy8xMjdcLjBcLjBcLjEvMFwuMFwuMFwuMC9nJyBjb25maWcuanNvbgpjaG1vZCAreCAuL2dvcGhpc2gKLi9nb3BoaXNoCg=="</span>
<span class="o">}</span>
</pre></table></code></div></div><p>First we need to initialize terraform in our current directory.</p><div class="language-markdown highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>terraform init
</pre></table></code></div></div><p>Then just to see how our changes will get reflected on the cloud, we can run.</p><div class="language-markdown highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>terraform plan
</pre></table></code></div></div><p>Once everything looks ,we can run</p><div class="language-markdown highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>terraform apply
</pre></table></code></div></div><p>It would ask us to type <strong>yes</strong> for the confirmation and if everything goes smooth, weâ€™ll see something like this.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/terraform-gophish/Pasted%20image%2020210430224820.png" alt="" /></p><p>If we refresh our instances page, we can see that our instance has been created and running.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/terraform-gophish/Pasted%20image%2020210430224902.png" alt="" /></p><p>If we try to visit the port 3333 of the public IP of this instance, we can see that our gophish is running there.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/terraform-gophish/Pasted%20image%2020210430225018.png" alt="" /></p><p>We can also ssh into our instance.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/terraform-gophish/Pasted%20image%2020210430225605.png" alt="" /></p><p>As can be seen our changes have been reflected.</p><p>To destroy everything with did with terraform, you can simply run.</p><div class="language-markdown highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>terraform destroy
</pre></table></code></div></div><p>Itâ€™ll then bring your AWS into a state it was before running the terraform apply.</p><p>You can follow the same terraform configuration file to automate and setup anything on ec2 instance or be it any virutal machines on azure or gcp or any other cloud which terraform supports.</p><p><strong>Final Note</strong>: I am by no means an expert in Cloud or Red Teaming, If you think I said anything incorrect anywhere, feel free to reach out to me and correct me, I would highly appreciate that. And finally thank you very much for taking your time to read this post.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/terraform-aws-automation/'>Terraform AWS automation</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/pentesting/" class="post-tag no-text-decoration" >pentesting</a> <a href="/tags/hacking/" class="post-tag no-text-decoration" >hacking</a> <a href="/tags/aws/" class="post-tag no-text-decoration" >aws</a> <a href="/tags/terraform/" class="post-tag no-text-decoration" >terraform</a> <a href="/tags/phishing/" class="post-tag no-text-decoration" >phishing</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Automating Phishing Infrastructure with terraform on AWS - Dazzy Ddos&url=https://dazzyddos.github.io/posts/Automating-Phishing-Infrastructure-with-terraform-on-AWS/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Automating Phishing Infrastructure with terraform on AWS - Dazzy Ddos&u=https://dazzyddos.github.io/posts/Automating-Phishing-Infrastructure-with-terraform-on-AWS/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Automating Phishing Infrastructure with terraform on AWS - Dazzy Ddos&url=https://dazzyddos.github.io/posts/Automating-Phishing-Infrastructure-with-terraform-on-AWS/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/(Un)Hooking,-COWs-and-Meow-Meow/">(Un)Hooking, COWs and Meow Meow</a><li><a href="/posts/Naughty_Hooking_Detoxifying_Memory/">Naughty Hooking Detoxifying Memory Before Doing Crime</a><li><a href="/posts/Remote-Process-Enumeration-with-WTS-Set-Of-APIs/">Remote Process Enumeration with WTS Set of Windows APIs</a><li><a href="/posts/AMSI-Bypass/">Defense Evasion Series Part 1 AMSI Bypass</a><li><a href="/posts/Automating-Phishing-Infrastructure-with-terraform-on-AWS/">Automating Phishing Infrastructure with terraform on AWS</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/pentesting/">pentesting</a> <a class="post-tag" href="/tags/hacking/">hacking</a> <a class="post-tag" href="/tags/frida/">frida</a> <a class="post-tag" href="/tags/hooking/">hooking</a> <a class="post-tag" href="/tags/tryhackme/">tryhackme</a> <a class="post-tag" href="/tags/unhooking/">unhooking</a> <a class="post-tag" href="/tags/walkthrough/">walkthrough</a> <a class="post-tag" href="/tags/amsi-bypass/">amsi bypass</a> <a class="post-tag" href="/tags/av-bypass/">av bypass</a> <a class="post-tag" href="/tags/aws/">aws</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/TryHackMe-Ra-Walkthrough/"><div class="card-body"> <span class="timeago small" > Feb 20, 2021 <i class="unloaded">2021-02-20T08:10:00+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>TryHackMe Ra Walkthrough</h3><div class="text-muted small"><p> Ra is an awesome box from TryHackMe by @4nqr34z and @theart42. Port Scanning and Basic Enumeration As always, will start with full port scan. Will do the other enumeration alongside till the nmap...</p></div></div></a></div><div class="card"> <a href="/posts/TryHackMe-Enterprise-Walkthrough/"><div class="card-body"> <span class="timeago small" > Mar 22, 2021 <i class="unloaded">2021-03-22T08:10:00+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>TryHackMe Enterprise Walkthrough</h3><div class="text-muted small"><p> Enterprise is an awesome box from TryHackMe by @NekoS3c You just landed in an internal network. You scan the network and thereâ€™s only the Domain Controllerâ€¦ Enumeration As always, weâ€™ll st...</p></div></div></a></div><div class="card"> <a href="/posts/Docker-Build-Stage-Security-Best-Practices/"><div class="card-body"> <span class="timeago small" > Apr 4, 2021 <i class="unloaded">2021-04-04T09:10:00+03:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Docker Build Stage Security Best Practices</h3><div class="text-muted small"><p> Introduction Hi Dear Readers, hope you all are safe and doing good. So, I welcome you all to the blog post on Docker Build Stage Security Best Practices. The title might be confusing to many since ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Docker-Build-Stage-Security-Best-Practices/" class="btn btn-outline-primary" prompt="Older"><p>Docker Build Stage Security Best Practices</p></a> <a href="/posts/AMSI-Bypass/" class="btn btn-outline-primary" prompt="Newer"><p>Defense Evasion Series Part 1 AMSI Bypass</p></a></div></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('.post-content img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> Â© 2024 <a href="https://twitter.com/dazzyddos">dazzy</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/pentesting/">pentesting</a> <a class="post-tag" href="/tags/hacking/">hacking</a> <a class="post-tag" href="/tags/frida/">frida</a> <a class="post-tag" href="/tags/hooking/">hooking</a> <a class="post-tag" href="/tags/tryhackme/">tryhackme</a> <a class="post-tag" href="/tags/unhooking/">unhooking</a> <a class="post-tag" href="/tags/walkthrough/">walkthrough</a> <a class="post-tag" href="/tags/amsi-bypass/">amsi bypass</a> <a class="post-tag" href="/tags/av-bypass/">av bypass</a> <a class="post-tag" href="/tags/aws/">aws</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://dazzyddos.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
