<!DOCTYPE html><html lang="en-US" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="pv-cache-enabled" content="false"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="Naughty Hooking Detoxifying Memory Before Doing Crime" /><meta name="author" content="Dazzy Ddos" /><meta property="og:locale" content="en_US" /><meta name="description" content="Introduction Konnichiwa my dear readers, I trust it‚Äôs been a while since my last update. I‚Äôm thrilled to be back, and I‚Äôm excited to delve into an intriguing, yet undeniably significant aspect of malware development and evasion today." /><meta property="og:description" content="Introduction Konnichiwa my dear readers, I trust it‚Äôs been a while since my last update. I‚Äôm thrilled to be back, and I‚Äôm excited to delve into an intriguing, yet undeniably significant aspect of malware development and evasion today." /><link rel="canonical" href="https://dazzyddos.github.io/posts/Naughty_Hooking_Detoxifying_Memory/" /><meta property="og:url" content="https://dazzyddos.github.io/posts/Naughty_Hooking_Detoxifying_Memory/" /><meta property="og:site_name" content="Dazzy Ddos" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-08-18T03:15:00+03:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Naughty Hooking Detoxifying Memory Before Doing Crime" /><meta name="twitter:site" content="@dazzyddos" /><meta name="twitter:creator" content="@Dazzy Ddos" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"Dazzy Ddos"},"description":"Introduction Konnichiwa my dear readers, I trust it‚Äôs been a while since my last update. I‚Äôm thrilled to be back, and I‚Äôm excited to delve into an intriguing, yet undeniably significant aspect of malware development and evasion today.","url":"https://dazzyddos.github.io/posts/Naughty_Hooking_Detoxifying_Memory/","@type":"BlogPosting","headline":"Naughty Hooking Detoxifying Memory Before Doing Crime","dateModified":"2023-08-18T06:29:49+03:00","datePublished":"2023-08-18T03:15:00+03:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://dazzyddos.github.io/posts/Naughty_Hooking_Detoxifying_Memory/"},"@context":"https://schema.org"}</script><title>Naughty Hooking Detoxifying Memory Before Doing Crime | Dazzy Ddos</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://avatars.githubusercontent.com/u/25081660?s=460&u=d7eb9a459d672ab9b0b1ccead34de3233e2843ee&v=4" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Dazzy Ddos</a></div><div class="site-subtitle font-italic"></div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/dazzyddos" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/dazzyddos" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['',''].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG ‚Ä∫ <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Naughty Hooking Detoxifying Memory Before Doing Crime</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Naughty Hooking Detoxifying Memory Before Doing Crime</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Fri, Aug 18, 2023, 3:15 AM +0300" > Aug 18, 2023 <i class="unloaded">2023-08-18T03:15:00+03:00</i> </span> by <span class="author"> Dazzy Ddos </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Fri, Aug 18, 2023, 8:59 AM +0530" > Aug 18, 2023 <i class="unloaded">2023-08-18T06:29:49+03:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="4384 words">24 min</span></div></div><div class="post-content"><h2 id="introduction">Introduction</h2><hr /><p>Konnichiwa my dear readers, I trust it‚Äôs been a while since my last update. I‚Äôm thrilled to be back, and I‚Äôm excited to delve into an intriguing, yet undeniably significant aspect of malware development and evasion today.</p><p>This blog post is comprehensive and may initially seem overwhelming. If you find it challenging to grasp everything at once, don‚Äôt worry. I recommend exploring other related blog posts, which I‚Äôve listed below for your convenience. Diversifying your sources often helps connect the dots, and over time, everything will fall into place.</p><p>Heads up, readers! This blog post is all about the world of Windows. We‚Äôre not venturing into macOS, Linux, or any other operating systems today. This post is the first in a series. I‚Äôve crafted it with beginners in mind to ensure clarity and ease of understanding.</p><p>You know all those things we use to keep our online world safe? Yeah, I‚Äôm talking about stuff like antivirus software, EDR products, Anti game cheat engines, those kinds of things. They‚Äôre pretty great, right? Always looking out for us, always guarding our systems and data from the bad guys. But here‚Äôs a crazy thought‚Ä¶ what if they‚Äôre not as bulletproof as we think?</p><p>That‚Äôs right, we‚Äôre about to peel back the layers on a pretty wild concept in Evasion ‚Äì it‚Äôs called ‚ÄòHooking and Unhooking.‚Äô Sounds kind of mysterious, doesn‚Äôt it? And yeah, it can get a bit technical, but stick with me.</p><p>Now, before we dive in, just a heads up ‚Äì we‚Äôre here to learn about this stuff so we can better protect our systems, not to give the bad guys any bright ideas. We‚Äôre gonna look at how this hooking and unhooking stuff works, check out some real-world examples, and chat about ways to fight back against these sneaky tactics.</p><p>Another heads up, folks: Hooking isn‚Äôt the only trick up the sleeves of EDRs and AVs when battling malware. They‚Äôve got other moves like kernel callbacks, ETW, ETWti, memory scans, and a bunch of tactics to collect telemetries. So, don‚Äôt give me grief if you‚Äôve only done unhooking on your EDR and it‚Äôs still spotting your malware. Eheh!</p><h2 id="guarding-the-gates-how-avs-and-edrs-use-hooking-against-malware">Guarding the Gates: How AVs and EDRs Use Hooking Against Malware</h2><p>Antivirus (AV) software and Endpoint Detection and Response (EDR) systems use hooking techniques in various ways to identify, monitor, and counteract malicious activities. Just as game anti-cheat systems utilize hooking to thwart cheating, AVs and EDRs use hooking to get a vantage point over potential threats. If you are interested in diving deeper into detection methods used by AVs and EDRs? Check out my previous <a href="https://dazzyddos.github.io/posts/AMSI-Bypass/#detection-methods-in-av">blog post</a></p><p>Malware often relies on specific system calls and API functions to execute malicious activities (like file creation, registry modification, or network communications). AV and EDR solutions can hook these calls to monitor and potentially block suspicious or unauthorized actions. Way back, kernel hooking was kind of a go-to for a lot of software, including security tools. But, as with everything tech, times change. Enter Microsoft with their Kernel Patch Protection, nicknamed PatchGuard, for 64-bit versions of Windows, starting with good old Vista. PatchGuard‚Äôs job? Keep pesky software from messing with the kernel, making most kernel hooking a no-go. Of course, there were those who found sneaky ways around it, but Microsoft usually came up with a counter-move pretty quick. Then there‚Äôs this whole driver signing thing. In layman‚Äôs terms? If you‚Äôve got a driver (like the ones you‚Äôd use for kernel-level hooking), it needs a digital autograph saying it‚Äôs legit. If it doesn‚Äôt have that signature, Windows ain‚Äôt having it.</p><p>Because of all these hoops, many EDRs and AVs thought, ‚ÄúMaybe kernel hooking isn‚Äôt the way.‚Äù Instead, they leaned into using the approved routes, like kernel callbacks, ETW, or hooks that chill in the user-mode.</p><p>EDR systems often use a sophisticated approach from kernel space to keep an eye on processes. Specifically, they harness kernel callbacks - with a focus on the <code class="language-plaintext highlighter-rouge">PsSetCreateProcessNotifyRoutineEx</code> callback. This callback gives the EDR a heads-up whenever a new process is initiated. At this time, the EDR injects its userland DLL module into the freshly started process. This DLL then hooks specific functions, allowing the EDR to continuously monitor their behaviors. <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/naughtyhooking1/Pasted%20image%2020230817225557.png" alt="" /></p><p>Alright, Enough with the preliminaries! Let‚Äôs dive deeper and unpack what we‚Äôve covered. We‚Äôll kick things off by exploring the different process execution modes in Windows.</p><h2 id="balancing-power-and-protection-kernel-mode-and-user-mode-in-windows">Balancing Power and Protection: Kernel Mode and User Mode in Windows</h2><p>When we talk about modern operating systems like Windows, there‚Äôs this nifty separation between what we call User Mode and Kernel Mode. Think of your computer as a big, bustling city.</p><p><strong>User Mode</strong> is like the city‚Äôs downtown area. It‚Äôs where all the day-to-day action happens. Apps chill here, they‚Äôre restricted in what they can do, and they can‚Äôt mess with the city‚Äôs infrastructure. It‚Äôs kinda like how you can‚Äôt just decide to reroute traffic or mess with city utilities.</p><p>Now, <strong>Kernel Mode</strong>? That‚Äôs the city‚Äôs control center. It‚Äôs where all the big decisions are made and where all the heavy machinery sits. From here, the OS can interact directly with the hardware, manage resources, and pretty much oversee the whole show. It‚Äôs where the magic happens. But with great power comes great responsibility. A hiccup here can cause citywide chaos (think traffic jams and power outages).</p><p>So, why this separation? It‚Äôs all about keeping the city (or your computer) running smoothly and safely. Apps in the downtown area can‚Äôt just waltz into the control center. They need to make a formal request, kinda like applying for a city permit. This ensures that our digital city remains secure and efficient.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/naughtyhooking1/Pasted%20image%2020230806103143.png" alt="" /></p><p>Applications running in User Mode can‚Äôt directly access the system‚Äôs hardware or access the core resources. They need to rely on the operating system to act as a bridge for such interactions. Here‚Äôs how the process unfolds:</p><p>When a User Mode application has a task that involves reaching out to the hardware or privileged resources, it makes what we call a ‚Äúsystem call‚Äù. This is basically the app knocking on the operating system‚Äôs door, saying, ‚ÄúHey, I need to do this thing, but I can‚Äôt on my own. Can you help?‚Äù</p><p>The operating system, always ready to assist, switches its cap from User Mode to Kernel Mode. Once it‚Äôs in Kernel Mode, it has all the permissions and the tools it needs to talk directly to the hardware.</p><p>With the right permissions, the operating system gets the task done, whether that‚Äôs reading from a disk, sending data over the internet, or something else entirely.</p><p>After wrapping up the task, the operating system slips back into User Mode and hands over the results to the application that made the request.</p><p>It‚Äôs worth noting that the operating system isn‚Äôt just blindly doing whatever the applications ask. It‚Äôs always on the lookout, checking that the requests from apps are legit and won‚Äôt cause any trouble. Think of it as a bouncer at a club, ensuring that no one‚Äôs causing a ruckus or breaking the rules.</p><p>In this way, the operating system ensures that our apps can do their jobs while keeping the whole system safe and sound.</p><h2 id="apis-adventure-from-userland-to-kernel-territory">APIs‚Äô Adventure from Userland to Kernel Territory</h2><p>The Windows API (Application Programming Interface) provides developers with a suite of functions to interact with the operating system. When an API call is made, there‚Äôs often a layered sequence of calls that eventually transition from user mode to kernel mode. The <code class="language-plaintext highlighter-rouge">CreateFileA</code> function, which is used to open or create a file, is a good example of this as shown below.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/naughtyhooking1/Pasted%20image%2020230806104923.png" alt="" /></p><p>Let‚Äôs break down how a <code class="language-plaintext highlighter-rouge">CreateFileA</code> call flows:</p><ol><li><p><strong>API Layer</strong>: When you, as a developer, make a call to <code class="language-plaintext highlighter-rouge">CreateFileA</code> in your application, you‚Äôre initially invoking a function provided by the Windows API. This function resides in user mode and is part of libraries like <code class="language-plaintext highlighter-rouge">kernel32.dll</code>.</p><li><p><strong>Wrapper Layer</strong>: This user-mode API doesn‚Äôt directly perform the action of creating or opening the file. Instead, it‚Äôs a wrapper that performs any necessary preprocessing and then calls a lower-level function to handle the main work. For <code class="language-plaintext highlighter-rouge">CreateFileA</code>, the preprocessing might include converting the ANSI filename to a Unicode (wide character) format because the Windows OS internally uses Unicode. After the conversion, it might then call <code class="language-plaintext highlighter-rouge">CreateFileW</code> (the wide-character version of the API).</p><li><p><strong>Transition to Kernel Mode</strong>: To actually interact with the file system (a privileged operation), the request must be passed to kernel mode. This transition is achieved using a mechanism like a system call or interrupt. The <code class="language-plaintext highlighter-rouge">NtCreateFile</code> function, which resides in <code class="language-plaintext highlighter-rouge">ntdll.dll</code> but is really a gateway to kernel-mode, is the next stop for our <code class="language-plaintext highlighter-rouge">CreateFile</code> request.</p><li><p><strong>Kernel Mode Operations</strong>: Once in kernel mode, the Windows kernel and its drivers handle the rest. The kernel‚Äôs I/O manager will cooperate with the appropriate file system driver (e.g., NTFS) to execute the file operation. It‚Äôs in this realm that the actual file is opened or created.</p><li><p><strong>Returning Results</strong>: Once the task is accomplished, the kernel passes the results (like a file handle or error code) back up the chain. The transition is made back to user mode, and the results are relayed through the same hierarchy but in reverse. The calling application eventually receives the outcome of its <code class="language-plaintext highlighter-rouge">CreateFileA</code> request.</p></ol><p>So, in essence, what seems like a simple call to open a file is a coordinated dance between various components, transitioning between user space and kernel space, ensuring both functionality and security.</p><p>Below is an example of 32 bit dispatching code when you run the code on 64 bit: <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/naughtyhooking1/Pasted%20image%2020230806115445.png" alt="" /></p><p>Above it might look confusing but the fundamental thing it‚Äôs doing is transitioning from 64-bit (long mode) to compatibility mode to execute 32-bit code, and then transitioning back. This is made possible because x86-64 CPUs support running 32-bit code through this compatibility mode and this technique is referred as Heaven‚Äôs Gate in Windows Programming, if you would like to read more about it, I would recommend going through this <a href="https://www.mandiant.com/resources/blog/wow64-subsystem-internals-and-hooking-techniques">Blog</a></p><p>In case of 64 bit, the transition looks like below: <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/naughtyhooking1/Pasted%20image%2020230806115634.png" alt="" /></p><p>Below I have written a simple code which we‚Äôll be using to see the usermode to kernel mode transitioning in <a href="https://hex-rays.com/ida-pro/">IDA</a>.</p><div class="language-c highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
</pre><td class="rouge-code"><pre><span class="cp">#include &lt;stdio.h&gt;
#include &lt;windows.h&gt;
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">HANDLE</span> <span class="n">hFile</span><span class="p">;</span>
    <span class="n">DWORD</span> <span class="n">dwBytesWritten</span><span class="p">;</span>

    <span class="c1">// Create or open the file</span>
    <span class="n">hFile</span> <span class="o">=</span> <span class="n">CreateFileA</span><span class="p">(</span>
        <span class="s">"lol.txt"</span><span class="p">,</span>                 <span class="c1">// name of the file</span>
        <span class="n">GENERIC_WRITE</span><span class="p">,</span>             <span class="c1">// open for writing</span>
        <span class="mi">0</span><span class="p">,</span>                         <span class="c1">// do not share</span>
        <span class="nb">NULL</span><span class="p">,</span>                      <span class="c1">// default security</span>
        <span class="n">CREATE_ALWAYS</span><span class="p">,</span>             <span class="c1">// overwrite existing</span>
        <span class="n">FILE_ATTRIBUTE_NORMAL</span><span class="p">,</span>     <span class="c1">// normal file</span>
        <span class="nb">NULL</span>                       <span class="c1">// no attr. template</span>
    <span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">hFile</span> <span class="o">==</span> <span class="n">INVALID_HANDLE_VALUE</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"Could not open file (error %d)</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">GetLastError</span><span class="p">());</span>
        <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Write data to the file</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">WriteFile</span><span class="p">(</span>
        <span class="n">hFile</span><span class="p">,</span>                    <span class="c1">// open file handle</span>
        <span class="s">"hi, howzzza doing"</span><span class="p">,</span>      <span class="c1">// data to write</span>
        <span class="mi">17</span><span class="p">,</span>                       <span class="c1">// number of bytes to write</span>
        <span class="o">&amp;</span><span class="n">dwBytesWritten</span><span class="p">,</span>          <span class="c1">// number of bytes that were written</span>
        <span class="nb">NULL</span>                      <span class="c1">// no overlapped structure</span>
    <span class="p">))</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"Could not write to file (error %d)</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">GetLastError</span><span class="p">());</span>
        <span class="n">CloseHandle</span><span class="p">(</span><span class="n">hFile</span><span class="p">);</span>
        <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">CloseHandle</span><span class="p">(</span><span class="n">hFile</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><p>So, it‚Äôs a simple C code which uses two Windows APIs i.e., <strong>CreateFile</strong> and <strong>WriteFile</strong>. Upon execution it just creates a file with name <em>lol.txt</em> with content ‚Äúhi, howzzza doing‚Äù <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/naughtyhooking1/Pasted%20image%2020230806114742.png" alt="" /></p><p>Let‚Äôs open it in our favorite IDA debugger/decompiler. I have set the breakpoint at the <em>CreateFileA</em> and started the debugger as shown below. <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/naughtyhooking1/Pasted%20image%2020230806125024.png" alt="" /></p><p>The purple line that follows takes to the code section that gets executed upon successful CreateFileA event, otherwise the execution will be followed by the red line block. That being said, we have hit our breakpoint, I‚Äôll press <code class="language-plaintext highlighter-rouge">F7</code> to <code class="language-plaintext highlighter-rouge">step into</code> the <strong>CreateFileA</strong> function block and you can see we have landed inside <code class="language-plaintext highlighter-rouge">kernel32.dll</code> as shown below. <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/naughtyhooking1/Pasted%20image%2020230815104636.png" alt="" /></p><p>If we once again <code class="language-plaintext highlighter-rouge">step into</code> , we will land inside <code class="language-plaintext highlighter-rouge">kernelbase.dll</code>. What this means is that the actual code to <code class="language-plaintext highlighter-rouge">CreateFile</code> is implemented inside the <code class="language-plaintext highlighter-rouge">kernelbase.dll</code></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/naughtyhooking1/Pasted%20image%2020230806125458.png" alt="" /></p><p>Let‚Äôs open the kernelbase.dll into our IDA to understand the flow better. <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/naughtyhooking1/Pasted%20image%2020230815105445.png" alt="" /></p><p>You‚Äôll see that it is calling a lot of functions like <code class="language-plaintext highlighter-rouge">RtlInitAnsiStringEx</code> which we don‚Äôt care as it deals with making sure the strings that we have passed to the function is correct and at some point it will get converted to the Unicode version. You‚Äôll notice that at some point, you‚Äôll have call to <code class="language-plaintext highlighter-rouge">CreateFileInternal</code> <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/naughtyhooking1/Pasted%20image%2020230815105710.png" alt="" /></p><p>Let‚Äôs go inside the function and you‚Äôll notice that it‚Äôs a huge function but at some point below you‚Äôll find that it‚Äôs calling the <code class="language-plaintext highlighter-rouge">NtCreateFile</code> <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/naughtyhooking1/Pasted%20image%2020230815110115.png" alt="" /></p><p>Let‚Äôs load the <code class="language-plaintext highlighter-rouge">ntdll.dll</code> into IDA this time to see <code class="language-plaintext highlighter-rouge">NtCreateFile</code> in detail. <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/naughtyhooking1/Pasted%20image%2020230815110532.png" alt="" /></p><p>Alright, we‚Äôve ventured deep into the inner workings of Windows with the <code class="language-plaintext highlighter-rouge">CreateFile</code> to syscall transition in IDA. Having that foundation, we‚Äôre perfectly positioned to dive into our next main topic of Hooking.</p><h2 id="inside-the-hook-manipulating-functions-the-cool-way">Inside the Hook: Manipulating Functions the Cool Way</h2><p>Alright, we‚Äôve journeyed through the intricacies of Windows processes and witnessed the seamless transition from userland APIs right down to the kernel using our trusty debugger. You might be thinking, ‚ÄòWhat‚Äôs hooking got to do with what we just went over?‚Äô Well, quite a lot! Hooking is a technique that can intercept and modify the behavior of functions like <code class="language-plaintext highlighter-rouge">CreateFile</code>, making it an essential topic for anyone wanting to understand the full spectrum of how software interacts, both benignly and maliciously, with the OS.</p><p>Hooking is a versatile technique, with various methods tailored to specific needs. Some prevalent types include:</p><ul><li><p><strong>Inline Function Hooking</strong>: This method targets the <code class="language-plaintext highlighter-rouge">.text</code> region of the program being hooked. Notably, Microsoft‚Äôs hooking library, known as ‚Äòdetours‚Äô, utilizes this technique.</p><li><p><strong>Virtual Method Table (VMT) Hooking</strong>: This approach focuses on the <code class="language-plaintext highlighter-rouge">.data</code> region, specifically where the virtual table address is stored. The virtual table itself comprises addresses of various functions.</p><li><p><strong>Import/Export Address Table Hooking</strong>: By adjusting addresses in the Import Address Table, this technique effectively hooks the target.</p><li><p><strong>Vectored Exception Handler (VEH) Hooking</strong>: This method is unique as it doesn‚Äôt rely on patching instructions or addresses. While its implementation is complex, it stands out due to its stealthy nature and the distinct indicators of compromise (IOCs) it generates.</p></ul><p>For the scope of this blog post, our primary focus will be on inline function hooking. However, future articles may delve into the intricacies of other hooking methods.‚Äù</p><p>We‚Äôll hook into specific functions to observe how these hooks appear in the debugger, and we‚Äôll even tinker around to alter our application‚Äôs behavior. Moving forward, we‚Äôll start by using Frida for our hooking endeavors. Before we dive deep into manual methods, let‚Äôs harness the power of Frida, turning it into our mini-EDR. It‚Äôll not only hook specific functions but also give us a nudge whenever our code decides to call upon those functions.</p><p>Before we jump into hooking or altering an API‚Äôs behavior, it‚Äôs crucial to first grasp the application‚Äôs behavior, especially regarding which API functions it‚Äôs calling. We have a few routes here: we can pop our code into a debugger and scrutinize the import table, or we can leverage tools like API Monitor. This handy tool doesn‚Äôt just show us the called APIs in real-time but also reveals the arguments passed to them. <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/naughtyhooking1/Pasted%20image%2020230817195552.png" alt="" /></p><p>When you launch the API Monitor tool, here‚Äôs the lay of the land:</p><ul><li><strong>First Tab:</strong> This is where you choose the module for which you want to monitor APIs. For this example, I‚Äôve picked the ‚ÄòData Access and Storage‚Äô module, specifically aiming to keep an eye on the <code class="language-plaintext highlighter-rouge">CreateFile</code> and related APIs.<li><strong>Second Tab:</strong> This displays all the currently running processes.<li><strong>Third Tab:</strong> Here, you‚Äôll find a list of processes that are under monitoring.<li><strong>Fourth Tab:</strong> A log of all the API calls shows up here.<li><strong>Fifth Tab:</strong> This delves deeper, showing the parameters for any API call you select from the fourth tab.</ul><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/naughtyhooking1/Pasted%20image%2020230817200128.png" alt="" /></p><p>In the example above, I fired up Notepad and began tracking it with API Monitor. The moment I attempted to save my text, voil√†! The <code class="language-plaintext highlighter-rouge">CreateFileW</code> and several other APIs sprang into action. <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/naughtyhooking1/Pasted%20image%2020230817200751.png" alt="" /></p><p>As evident from above, when I kickstarted <code class="language-plaintext highlighter-rouge">frida-trace</code> to scout for API calls beginning with <code class="language-plaintext highlighter-rouge">CreateFile*</code> on the Notepad process, it began listing those calls right away. Bonus? By default, it generates a JavaScript file ‚Äì a ready-to-use Frida script. With it, we can delve into parameters or even tweak the API‚Äôs functionality. Let‚Äôs see how this script looks like. These are all the folders and files created the first time we run frida-trace tool. <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/naughtyhooking1/Pasted%20image%2020230817201337.png" alt="" /></p><p>We are interested in the <code class="language-plaintext highlighter-rouge">CreateFileA</code> and the contents of it look like below. <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/naughtyhooking1/Pasted%20image%2020230817201430.png" alt="" /></p><p>From what we can observe, the default behavior simply logs to the screen every time <code class="language-plaintext highlighter-rouge">CreateFileA</code> is invoked. We know that <code class="language-plaintext highlighter-rouge">CreateFileA</code> is going to call <code class="language-plaintext highlighter-rouge">CreateFileW</code>, so let‚Äôs modify that script instead. Let‚Äôs modify it a bit to also print the arguments to that API whenever it was called.</p><p>We can utilize the official <strong>msdn</strong> documentation to see how the arguments to <code class="language-plaintext highlighter-rouge">CreateFileW</code> looks like <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/naughtyhooking1/Pasted%20image%2020230817204000.png" alt="" /></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/naughtyhooking1/Pasted%20image%2020230817203813.png" alt="" /> In the script, we‚Äôre tapping into the <code class="language-plaintext highlighter-rouge">CreateFileW</code> function to monitor its calls and print its arguments. Let‚Äôs dissect this script step-by-step:</p><ul><li><p><strong>onEnter(log, args, state)</strong>:</p><ul><li><code class="language-plaintext highlighter-rouge">onEnter</code> is a callback triggered right before the hooked function (<code class="language-plaintext highlighter-rouge">CreateFileA</code> in this case) executes.<li><code class="language-plaintext highlighter-rouge">log</code> is a function we can use to print messages to the console.<li><code class="language-plaintext highlighter-rouge">args</code> is an array that contains the arguments passed to the hooked function.<li><code class="language-plaintext highlighter-rouge">state</code> can be used to store data between the <code class="language-plaintext highlighter-rouge">onEnter</code> and <code class="language-plaintext highlighter-rouge">onLeave</code> callbacks, though it‚Äôs not utilized in this specific script.</ul><li><p><strong>log(‚ÄòCreateFileW() called‚Äô)</strong>:</p><ul><li>This line just prints a message to the console whenever <code class="language-plaintext highlighter-rouge">CreateFileW</code> is invoked.</ul><li><p><strong>log(‚Äò[+] lpFileName: ‚Äò + Memory.readUtf16String(args[0]))</strong>:</p><ul><li><code class="language-plaintext highlighter-rouge">lpFileName</code> is the name of the file or device to be created or opened.<li><code class="language-plaintext highlighter-rouge">Memory.readUtf16String(args[0])</code> reads the string argument (in UTF-16 format) passed to <code class="language-plaintext highlighter-rouge">CreateFileA</code> which is the file or device name.</ul></ul><p>From here, the script is pretty straightforward. If you‚Äôre curious about the other parameters or arguments for <code class="language-plaintext highlighter-rouge">CreateFileW</code>, I‚Äôd recommend checking out its official documentation right here: <a href="https://learn.microsoft.com/en-us/windows/win32/api/fileapi/nf-fileapi-createfilew">Microsoft‚Äôs Documentation on CreateFileW</a>. It provides a comprehensive breakdown of each parameter and its potential values.</p><p>As you‚Äôll notice in the image below, when we run <code class="language-plaintext highlighter-rouge">frida-trace</code> now, it doesn‚Äôt just tell us the function was called ‚Äì it also reveals the specific arguments that were passed to it. This level of detail can be incredibly insightful! <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/naughtyhooking1/Pasted%20image%2020230817203745.png" alt="" /></p><p>Alright folks, buckle up! We‚Äôre about to take our journey up a notch. From this point forward, I‚Äôll be introducing you to a slick tool named <a href="https://github.com/FuzzySecurity/Fermion">Fermion</a>. Think of it as the cool, stylish cousin of Frida‚Äîa front-end interface that makes the whole process smoother. And yeah, it‚Äôs pretty rad! üòé There are minor syntax differences in the syntax for the Fermion, we are now doing pointer resolution for the function we want to hook and using send() method to log to the screen instead of log(). Let‚Äôs first do the same thing we had done with <code class="language-plaintext highlighter-rouge">frida-trace.exe</code> i.e., hooking <code class="language-plaintext highlighter-rouge">CreateFileW</code> inside <strong>notepad.exe</strong> <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/naughtyhooking1/Pasted%20image%2020230817212059.png" alt="" /></p><p>Once the instrumentation has started, in the log tab, the specific API calls will start to show up. <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/naughtyhooking1/Pasted%20image%2020230817211759.png" alt="" /></p><p>Alright, folks, it‚Äôs throwback time! Remember our old friend <code class="language-plaintext highlighter-rouge">createfiledemo.c</code>? Let‚Äôs bring it back to the spotlight. This time, we‚Äôre going to hook <code class="language-plaintext highlighter-rouge">CreateFileA</code> from it. And to spice things up, we‚Äôll get a behind-the-scenes look at how Frida works its magic with the trusty <strong>Windbg</strong> debugger. <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/naughtyhooking1/Pasted%20image%2020230817213532.png" alt="" /></p><p>I‚Äôve added a <code class="language-plaintext highlighter-rouge">getchar()</code> to the code, allowing us to pause the program. This gives us a chance to observe the <code class="language-plaintext highlighter-rouge">CreateFileA</code> function both before and after the hooking is performed. It‚Äôs a useful way to see the effects of our modifications in real-time. <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/naughtyhooking1/Pasted%20image%2020230817214440.png" alt="" /></p><p>After hooking with frida, the modified assembly code for <code class="language-plaintext highlighter-rouge">CreateFileA</code> looks like below. Once hooked, this is how the hooked <code class="language-plaintext highlighter-rouge">CreateFileA</code> looks like: <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/naughtyhooking1/Pasted%20image%2020230817215408.png" alt="" /></p><p>Now let‚Äôs attach <strong>x64dbg</strong> into the <code class="language-plaintext highlighter-rouge">createfiledemo.exe</code> process and analyze it a bit. If you go the Memory Map tab, you can see the frida-agent.dll being loaded into the process <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/naughtyhooking1/Pasted%20image%2020230817215646.png" alt="" /></p><p>You could have also verified the same using the <strong>windbg</strong> <code class="language-plaintext highlighter-rouge">lm</code> command. Now let‚Äôs go to the <code class="language-plaintext highlighter-rouge">CreateFileA</code> in the <code class="language-plaintext highlighter-rouge">kernelbase.dll</code> module and set a breakpoint there. <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/naughtyhooking1/Pasted%20image%2020230817220157.png" alt="" /></p><p>Now let‚Äôs continue running the program and wait for the breakpoint to hit. You‚Äôll observe that now we are into the <code class="language-plaintext highlighter-rouge">frida-agent</code> code section which does the actual hooking. <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/naughtyhooking1/Pasted%20image%2020230817220334.png" alt="" /></p><p>Our breakpoint has been hit and we can see all the arguments to the <code class="language-plaintext highlighter-rouge">CreatefileA</code> in the registers tab, let‚Äôs keep stepping into see where are we getting landed. <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/naughtyhooking1/Pasted%20image%2020230817221438.png" alt="" /></p><p>Next, we‚Äôll delve into another example. Instead of just displaying the arguments on the screen, we‚Äôll also alter the API function‚Äôs behavior. For this demonstration, I‚Äôll use the MessageBox API. However, feel free to experiment with any API you‚Äôre interested in modifying.</p><div class="language-c highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="cp">#include &lt;windows.h&gt;
#include &lt;stdio.h&gt;
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
     <span class="n">MessageBoxA</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="s">"MessageBox 1"</span><span class="p">,</span> <span class="s">"MessageBoxA"</span><span class="p">,</span> <span class="n">MB_OK</span><span class="p">);</span>

     <span class="n">printf</span><span class="p">(</span><span class="s">"Press any key to continue"</span><span class="p">);</span>
     <span class="n">getchar</span><span class="p">();</span>

     <span class="n">MessageBoxA</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="s">"MessageBox 2"</span><span class="p">,</span> <span class="s">"MessageBoxA"</span><span class="p">,</span> <span class="n">MB_OK</span><span class="p">);</span>

     <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Let‚Äôs take a look at a basic example that uses the <code class="language-plaintext highlighter-rouge">MessageBoxA</code> API to display two message boxes sequentially on the screen. When executed, this code will display the first message box. After closing it and pressing any key in the console, the second message box will appear. <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/naughtyhooking1/Pasted%20image%2020230817222420.png" alt="" /></p><p>In the above example, we merely displayed the arguments passed to the <code class="language-plaintext highlighter-rouge">MessageBoxA</code> API within Frida‚Äôs output. Now, let‚Äôs adapt our Frida script to modify the <code class="language-plaintext highlighter-rouge">MessageBoxA</code> API so that it displays a different message.</p><div class="language-javascript highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="kd">var</span> <span class="nx">pMessageBoxA</span> <span class="o">=</span> <span class="nx">Module</span><span class="p">.</span><span class="nx">findExportByName</span><span class="p">(</span><span class="dl">"</span><span class="s2">user32.dll</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">MessageBoxA</span><span class="dl">"</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">newMessage</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

<span class="nx">Interceptor</span><span class="p">.</span><span class="nx">attach</span><span class="p">(</span><span class="nx">pMessageBoxA</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">onEnter</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">send</span><span class="p">(</span><span class="dl">"</span><span class="se">\n</span><span class="s2">[+] Called MessageBoxA</span><span class="dl">"</span><span class="p">);</span>
        <span class="nx">send</span><span class="p">(</span><span class="dl">"</span><span class="s2">[*] hWnd      : </span><span class="dl">"</span> <span class="o">+</span> <span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
        <span class="nx">send</span><span class="p">(</span><span class="dl">"</span><span class="s2">[*] lpText    : </span><span class="dl">"</span> <span class="o">+</span> <span class="nx">args</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">readAnsiString</span><span class="p">());</span>
        <span class="nx">send</span><span class="p">(</span><span class="dl">"</span><span class="s2">[*] lpCaption : </span><span class="dl">"</span> <span class="o">+</span> <span class="nx">args</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="nx">readAnsiString</span><span class="p">());</span>
        <span class="nx">send</span><span class="p">(</span><span class="dl">"</span><span class="s2">[*] uType     : </span><span class="dl">"</span> <span class="o">+</span> <span class="nx">args</span><span class="p">[</span><span class="mi">3</span><span class="p">]);</span>

        <span class="nx">newMessage</span> <span class="o">=</span> <span class="nx">Memory</span><span class="p">.</span><span class="nx">allocAnsiString</span><span class="p">(</span><span class="dl">"</span><span class="s2">HACKED MESSAGEBOX</span><span class="dl">"</span><span class="p">);</span>
        <span class="nx">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nx">newMessage</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></table></code></div></div><p>In the line <code class="language-plaintext highlighter-rouge">newMessage = Memory.allocAnsiString("HACKED MESSAGEBOX");</code>, we‚Äôre essentially telling Frida to allocate memory for a new Ansi string and set its value to ‚ÄúHACKED MESSAGEBOX‚Äù. This is how we dynamically create and store our modified string for later use.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/naughtyhooking1/Pasted%20image%2020230817222704.png" alt="" /></p><p>From the image above, it‚Äôs evident that the second time the message box popped up, it displayed our custom string. That‚Äôs the magic of Frida ‚Äì letting us modify behavior on-the-fly during runtime.</p><p>Diving deeper, let‚Äôs explore the manual side of things. Instead of relying solely on tools, we‚Äôll get our hands a bit dirty. We‚Äôre going to craft a simple DLL. When injected into a process, this DLL will essentially overwrite a specific API function, altering its behavior to our liking. This method, often called DLL injection, is one of the foundational techniques in the world of hooking.</p><p><code class="language-plaintext highlighter-rouge">hook.c</code></p><pre><code class="language-C">#include &lt;windows.h&gt;
#include &lt;stdio.h&gt;

BOOL hooked = FALSE;
SIZE_T bytesWritten;
char messageBoxOriginalBytes[6] = {};

FARPROC messageBoxAaddr = NULL;

int __stdcall hookedMessageBox(HWND hWnd, LPCSTR lpText, LPCSTR lpCaption, UINT uType) {
    // unpatch
    WriteProcessMemory(GetCurrentProcess(), (LPVOID)messageBoxAaddr, messageBoxOriginalBytes, sizeof(messageBoxOriginalBytes), &amp;bytesWritten);

    lpText = "HACKED";

    return MessageBoxA(NULL, lpText, lpCaption, uType);
}

void hook()
{
    if (!hooked) {
        SIZE_T bytesRead;

        messageBoxAaddr = GetProcAddress(LoadLibraryA("user32.dll"), "MessageBoxA");
        ReadProcessMemory(GetCurrentProcess(), messageBoxAaddr, messageBoxOriginalBytes, 6, &amp;bytesRead);

        SIZE_T dwSize = 7;
        CHAR patch[6] = { 0 };
        CHAR *addr = (CHAR*)messageBoxAaddr;
        DWORD dwOld;

        VirtualProtect((VOID*)messageBoxAaddr, dwSize, PAGE_EXECUTE_READWRITE, &amp;dwOld);

        void *hookedMessageBoxAddr = &amp;hookedMessageBox;
        memcpy_s(patch, 1, "\x68", 1); // push hookedMessageBoxAddr; ret
        memcpy_s(patch + 1, 4, &amp;hookedMessageBoxAddr, 4);
        memcpy_s(patch + 5, 1, "\xc3", 1);

        // patch the MessageBoxA
        WriteProcessMemory(GetCurrentProcess(), (LPVOID)messageBoxAaddr, patch, sizeof(patch), &amp;bytesWritten);
    }

    hooked = TRUE;
}

BOOL APIENTRY DllMain(HINSTANCE hInstDLL, DWORD  fdwReason, LPVOID lpReserved)
{
    switch (fdwReason)
    {
    case DLL_PROCESS_ATTACH:
        hook();
        break;
    case DLL_THREAD_ATTACH:
    case DLL_THREAD_DETACH:
    case DLL_PROCESS_DETACH:
        break;
    }
    return TRUE;
}
</code></pre><p>Let‚Äôs try to break the above code:</p><pre><code class="language-C">BOOL hooked = FALSE;
SIZE_T bytesWritten;
char messageBoxOriginalBytes[6] = {};
FARPROC messageBoxAaddr = NULL;
</code></pre><p>These global variables are:</p><ul><li><code class="language-plaintext highlighter-rouge">hooked</code>: Used to check if the MessageBoxA function is already hooked.<li><code class="language-plaintext highlighter-rouge">bytesWritten</code>: Stores the number of bytes written using the <code class="language-plaintext highlighter-rouge">WriteProcessMemory</code> function.<li><code class="language-plaintext highlighter-rouge">messageBoxOriginalBytes</code>: Used to store the original bytes of the <code class="language-plaintext highlighter-rouge">MessageBoxA</code> function, enabling unhooking later.<li><p><code class="language-plaintext highlighter-rouge">messageBoxAaddr</code>: Pointer to the location of <code class="language-plaintext highlighter-rouge">MessageBoxA</code> function in memory.</p><li><strong>hookedMessageBox Function</strong>: This is the hook function that will replace the original <code class="language-plaintext highlighter-rouge">MessageBoxA</code>. Before showing the message, it:<ul><li>Restores the original bytes of <code class="language-plaintext highlighter-rouge">MessageBoxA</code> (unhook).<li>Modifies the message to display to ‚ÄúHACKED‚Äù.<li>Calls the original <code class="language-plaintext highlighter-rouge">MessageBoxA</code>.</ul><li><p><strong>hook Function</strong>: This function sets up the hook. It:</p><ul><li>Checks if the function is already hooked using the <code class="language-plaintext highlighter-rouge">hooked</code> variable.<li>Gets the address of <code class="language-plaintext highlighter-rouge">MessageBoxA</code> in memory.<li>Saves the first 6 bytes of the original <code class="language-plaintext highlighter-rouge">MessageBoxA</code>.<li>Modifies memory protection of the <code class="language-plaintext highlighter-rouge">MessageBoxA</code> function to make it writable.<li>Creates a patch that will make the original function jump to <code class="language-plaintext highlighter-rouge">hookedMessageBox</code> when called and writes this patch over the original <code class="language-plaintext highlighter-rouge">MessageBoxA</code> function (<code class="language-plaintext highlighter-rouge">push hookedMessageBoxAddr; ret</code>)</ul></ul><p><code class="language-plaintext highlighter-rouge">In essence, when the DLL is loaded, the </code>hook<code class="language-plaintext highlighter-rouge"> function will make it so that any subsequent calls to MessageBoxA from the hosting process will always display a message box with "HACKED", before restoring the function to its original state.</code></p><p>For our demonstration, we‚Äôll utilize the classic DLL Injection technique to inject our DLL into a target process. This method essentially involves a sequence of steps: initiating with <code class="language-plaintext highlighter-rouge">OpenProcess</code> to get a handle, followed by <code class="language-plaintext highlighter-rouge">VirtualAllocEx</code> for memory allocation within the process, then <code class="language-plaintext highlighter-rouge">WriteProcessMemory</code> to place our DLL into that memory, and finally, <code class="language-plaintext highlighter-rouge">CreateRemoteThread</code> to kickstart the execution of our DLL within the process‚Äôs context.</p><p>Next, let‚Äôs take a look by examining the <code class="language-plaintext highlighter-rouge">MessageBoxA</code> function within the <strong>windbg</strong> debugger‚Äîboth before and after our hook is applied. The below image shows the original MessageBoxA function before hooking. <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/naughtyhooking1/Pasted%20image%2020230818073050.png" alt="" /></p><p>Once you inject the DLL and resume the program‚Äôs execution, <strong>WinDbg</strong> will provide a notification about the DLL being loaded <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/naughtyhooking1/Pasted%20image%2020230818073208.png" alt="" /></p><p>You can also verify the loaded DLLs using the <code class="language-plaintext highlighter-rouge">lm</code> command in <strong>WinDbg</strong>. <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/naughtyhooking1/Pasted%20image%2020230818073323.png" alt="" /></p><p>Now, let‚Äôs examine the appearance of the <code class="language-plaintext highlighter-rouge">MessageBoxA</code> API post-hooking. <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/naughtyhooking1/Pasted%20image%2020230818073501.png" alt="" /></p><p>From the above image, it‚Äôs evident that the first instruction of the <code class="language-plaintext highlighter-rouge">MessageBoxA</code> API has been replaced with the <code class="language-plaintext highlighter-rouge">push</code> and <code class="language-plaintext highlighter-rouge">ret</code> instructions. Now, let‚Äôs proceed and let the program run.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://raw.githubusercontent.com/dazzyddos/dazzyddos.github.io/master/Images/naughtyhooking1/Pasted%20image%2020230817224606.png" alt="" /></p><p>From the above results, it‚Äôs evident that we successfully injected our <code class="language-plaintext highlighter-rouge">hook.dll</code> into the <code class="language-plaintext highlighter-rouge">message.exe</code> process. Consequently, we managed to alter the <code class="language-plaintext highlighter-rouge">MessageBoxA</code> argument, displaying our custom ‚ÄòHACKED‚Äô message.</p><p>That wraps up our exploration for this post. In our upcoming blog entry, we‚Äôll delve into the art of unhooking, focusing on undoing the modifications made by tools like Frida, and discussing various other unhooking techniques. Stay tuned!</p><h2 id="further-resources">Further Resources</h2><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>- https://mr.un1k0d3r.world/portal/
- https://www.mdsec.co.uk/2020/12/bypassing-user-mode-hooks-and-direct-invocation-of-system-calls-for-red-teams/
- https://blog.nviso.eu/2022/08/05/finding-hooks-with-windbg/
- http://phrack.org/issues/65/10.html#article
- https://www.codeproject.com/Articles/2082/API-hooking-revealed
</pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/defense-evasion/'>Defense Evasion</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/evasion/" class="post-tag no-text-decoration" >evasion</a> <a href="/tags/hooking/" class="post-tag no-text-decoration" >hooking</a> <a href="/tags/unhooking/" class="post-tag no-text-decoration" >unhooking</a> <a href="/tags/frida/" class="post-tag no-text-decoration" >frida</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Naughty Hooking Detoxifying Memory Before Doing Crime - Dazzy Ddos&url=https://dazzyddos.github.io/posts/Naughty_Hooking_Detoxifying_Memory/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Naughty Hooking Detoxifying Memory Before Doing Crime - Dazzy Ddos&u=https://dazzyddos.github.io/posts/Naughty_Hooking_Detoxifying_Memory/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Naughty Hooking Detoxifying Memory Before Doing Crime - Dazzy Ddos&url=https://dazzyddos.github.io/posts/Naughty_Hooking_Detoxifying_Memory/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/(Un)Hooking,-COWs-and-Meow-Meow/">(Un)Hooking, COWs and Meow Meow</a><li><a href="/posts/Naughty_Hooking_Detoxifying_Memory/">Naughty Hooking Detoxifying Memory Before Doing Crime</a><li><a href="/posts/Remote-Process-Enumeration-with-WTS-Set-Of-APIs/">Remote Process Enumeration with WTS Set of Windows APIs</a><li><a href="/posts/AMSI-Bypass/">Defense Evasion Series Part 1 AMSI Bypass</a><li><a href="/posts/Automating-Phishing-Infrastructure-with-terraform-on-AWS/">Automating Phishing Infrastructure with terraform on AWS</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/pentesting/">pentesting</a> <a class="post-tag" href="/tags/hacking/">hacking</a> <a class="post-tag" href="/tags/frida/">frida</a> <a class="post-tag" href="/tags/hooking/">hooking</a> <a class="post-tag" href="/tags/tryhackme/">tryhackme</a> <a class="post-tag" href="/tags/unhooking/">unhooking</a> <a class="post-tag" href="/tags/walkthrough/">walkthrough</a> <a class="post-tag" href="/tags/amsi-bypass/">amsi bypass</a> <a class="post-tag" href="/tags/av-bypass/">av bypass</a> <a class="post-tag" href="/tags/aws/">aws</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/(Un)Hooking,-COWs-and-Meow-Meow/"><div class="card-body"> <span class="timeago small" > Oct 14, 2023 <i class="unloaded">2023-10-14T03:15:00+03:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>(Un)Hooking, COWs and Meow Meow</h3><div class="text-muted small"><p> Konichiwa to all my readers! Today, I‚Äôm sharing a concise blog post centered on a query that arose during a malware development training session I was conducting. This post contains my observations...</p></div></div></a></div><div class="card"> <a href="/posts/AMSI-Bypass/"><div class="card-body"> <span class="timeago small" > Aug 18, 2021 <i class="unloaded">2021-08-18T09:10:00+03:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Defense Evasion Series Part 1 AMSI Bypass</h3><div class="text-muted small"><p> Introduction Hello Folks. This is the beginning of a new blog post series on various Defense Evasion techniques. In Part 1, we will look into what is AMSI, how it works and how to bypass it. Prer...</p></div></div></a></div><div class="card"> <a href="/posts/Abusing_Exclusions_To_Evade_Detection/"><div class="card-body"> <span class="timeago small" > Aug 11 <i class="unloaded">2024-08-11T03:15:00+03:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Abusing Exclusions To Evade Detection</h3><div class="text-muted small"><p> Long time dear readers. In this blog post we‚Äôll see how to abuse a common feature in Antivirus and EDRs that‚Äôs not much talked about. I am using Defender AV as that‚Äôs common and by default across a...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/Remote-Process-Enumeration-with-WTS-Set-Of-APIs/" class="btn btn-outline-primary" prompt="Older"><p>Remote Process Enumeration with WTS Set of Windows APIs</p></a> <a href="/posts/(Un)Hooking,-COWs-and-Meow-Meow/" class="btn btn-outline-primary" prompt="Newer"><p>(Un)Hooking, COWs and Meow Meow</p></a></div></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('.post-content img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> ¬© 2024 <a href="https://twitter.com/dazzyddos">dazzy</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/pentesting/">pentesting</a> <a class="post-tag" href="/tags/hacking/">hacking</a> <a class="post-tag" href="/tags/frida/">frida</a> <a class="post-tag" href="/tags/hooking/">hooking</a> <a class="post-tag" href="/tags/tryhackme/">tryhackme</a> <a class="post-tag" href="/tags/unhooking/">unhooking</a> <a class="post-tag" href="/tags/walkthrough/">walkthrough</a> <a class="post-tag" href="/tags/amsi-bypass/">amsi bypass</a> <a class="post-tag" href="/tags/av-bypass/">av bypass</a> <a class="post-tag" href="/tags/aws/">aws</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://dazzyddos.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
